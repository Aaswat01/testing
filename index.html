<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>19</title>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.js"></script>

    <!-- Leaflet-Rotate (REAL FILE) -->
    <script src="https://rawcdn.githack.com/Raruto/leaflet-rotate/master/dist/leaflet-rotate-src.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        #map { width: 100vw; height: 100vh; }

        #follow-btn {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: #0078FF;
            color: white;
            border-radius: 12px;
            padding: 10px 14px;
            cursor: pointer;
            z-index: 9999;
        }
    </style>
</head>

<body>

<div id="map"></div>
<div id="follow-btn">FOLLOW: ON</div>

<script>
/* ---------------- MAP SETUP ---------------- */
const map = L.map('map', {
    center: [20.5937, 78.9629],
    zoom: 18,
    rotate: true,
    rotateControl: true,   // behaves like GitHub demo
    bearing: 0,            // default north
    touchRotate: true,
    compassBearing: true,  // lets device heading control rotation smoothly
});

/* ---------------- TILE ---------------- */
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 22
}).addTo(map);

/* ---------------- DEBUG (like original example) ---------------- */
L.Rotate.debug(map);

/* ---------------- FOLLOW MODE ---------------- */
let follow = true;
document.getElementById("follow-btn").onclick = () => {
    follow = !follow;
    document.getElementById("follow-btn").innerText = `FOLLOW: ${follow ? "ON" : "OFF"}`;
};

/* ---------------- USER MARKER ---------------- */
const userMarker = L.marker([0,0]).addTo(map);

/* ---------------- GEO TRACKING WITH ROTATION ---------------- */
if (navigator.geolocation) {
    navigator.geolocation.watchPosition(pos => {

        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const heading = pos.coords.heading;

        userMarker.setLatLng([lat, lng]);

        // Auto-rotate only if follow mode is ON & phone gives bearing
        if (follow && heading !== null) {
            map.setBearing(heading, { animate: true });
        }

        // Center map only if follow mode enabled
        if (follow) {
            map.setView([lat, lng], map.getZoom(), { animate: true });
        }

    }, console.log, { enableHighAccuracy: true });
}
</script>

</body>
</html>
